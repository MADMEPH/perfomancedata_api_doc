# Эндпоинты API

Полный справочник по всем эндпоинтам Perion API.

## Базовый URL

```
https://domain.com/api
```

## Обзор эндпоинтов

| Эндпоинт | Метод | Требуется аутентификация | Описание |
|----------|-------|--------------------------|----------|
| `/health` | GET | ❌ Нет | Проверка работоспособности |
| `/daily` | GET | ✅ Да | Дневные данные производительности |
| `/hourly` | GET | ✅ Да | Почасовые данные производительности |

---

## Проверка работоспособности

<span class="api-method get">GET</span> `/health`

Проверка работоспособности API сервиса.

**Аутентификация:** Не требуется

### Запрос

```bash
curl -X GET https://domain.com/api/health
```

### Ответ

```json
{
  "status": "ok",
  "service": "Perion API Integration",
  "timestamp": "2025-11-25T10:30:45+00:00"
}
```

### Поля ответа

| Поле | Тип | Описание |
|------|-----|----------|
| `status` | string | Статус сервиса (`ok` или `error`) |
| `service` | string | Название сервиса |
| `timestamp` | string | Текущее время сервера (ISO 8601) |

---

## Дневные данные производительности

<span class="api-method get">GET</span> `/daily`

Получение агрегированных данных производительности по дням.

**Аутентификация:** Требуется (API Key)

### Параметры запроса

| Параметр | Тип | Обязательный | По умолчанию | Описание |
|----------|-----|--------------|--------------|----------|
| `start_date` | string | Нет | Сегодня | Начальная дата (`YYYY-MM-DD`) |
| `end_date` | string | Нет | `start_date` | Конечная дата (`YYYY-MM-DD`) |
| `asset_gid` | string | Нет | - | ID ассета(ов), через запятую |

### Примеры запросов

::: code-group

```bash [Базовый]
curl -X GET "https://domain.com/api/daily?start_date=2025-11-01&end_date=2025-11-30" \
  -H "API-Key: ВАШ_API_КЛЮЧ"
```

```bash [С фильтром]
curl -X GET "https://domain.com/api/daily?start_date=2025-11-01&asset_gid=AP1008794,AP1008795" \
  -H "API-Key: ВАШ_API_КЛЮЧ"
```

```bash [Данные за сегодня]
curl -X GET "https://domain.com/api/daily" \
  -H "API-Key: ВАШ_API_КЛЮЧ"
```

:::

### Ответ

```json
{
  "success": true,
  "data": [
    {
      "date": "2025-11-01",
      "asset_gid": "AP1008794",
      "country_code": "US",
      "country_name": "United States",
      "channel": "search",
      "device": "Desktop",
      "revenue": 125.50,
      "ad_clicks": 1250,
      "ctr": 2.5,
      "rpc": 0.10
    }
  ],
  "meta": {
    "count": 1,
    "filters": {
      "start_date": "2025-11-01",
      "end_date": "2025-11-30",
      "asset_gid": "AP1008794,AP1008795"
    },
    "storage": {
      "new_records": 1,
      "updated_records": 0
    }
  }
}
```



---

## Почасовые данные производительности

<span class="api-method get">GET</span> `/hourly`

Получение данных производительности, агрегированных по часам.

**Аутентификация:** Требуется (API Key)

::: warning Доступность данных
Почасовые данные доступны только за **последние 14 дней**.
:::

### Параметры запроса

| Параметр | Тип | Обязательный | По умолчанию | Описание |
|----------|-----|--------------|--------------|----------|
| `start_date` | string | Нет | Сегодня | Начальная дата (`YYYY-MM-DD`, макс. 14 дней назад) |
| `end_date` | string | Нет | `start_date` | Конечная дата (`YYYY-MM-DD`) |
| `asset_gid` | string | Нет | - | ID ассета(ов), через запятую |

### Примеры запросов

::: code-group

```bash [Сегодня]
curl -X GET "https://domain.com/api/hourly?start_date=2025-11-25" \
  -H "API-Key: ВАШ_API_КЛЮЧ"
```

```bash [Последние 3 дня]
curl -X GET "https://domain.com/api/hourly?start_date=2025-11-22&end_date=2025-11-25" \
  -H "API-Key: ВАШ_API_КЛЮЧ"
```

```bash [С фильтром]
curl -X GET "https://domain.com/api/hourly?start_date=2025-11-25&asset_gid=AP1008794" \
  -H "API-Key: ВАШ_API_КЛЮЧ"
```

:::

### Ответ

```json
{
  "success": true,
  "data": [
    {
      "date": "2025-11-25",
      "hour": "10",
      "asset_gid": "AP1008794",
      "country_code": "US",
      "country_name": "United States",
      "channel": "search",
      "device": "Desktop",
      "revenue": 12.50,
      "ad_clicks": 125,
      "ctr": 2.5,
      "rpc": 0.10
    }
  ],
  "meta": {
    "count": 1,
    "filters": {
      "start_date": "2025-11-25",
      "end_date": "2025-11-25"
    }
  }
}
```

### Дополнительные поля

В дополнение ко всем полям дневных данных, почасовые данные включают:

| Поле | Тип | Описание |
|------|-----|----------|
| `hour` | string | Час дня (0-23) |

---

## Формат ответа

Все успешные ответы следуют этой структуре:

```json
{
  "success": true,
  "data": [...],
  "meta": {...}
}
```

Ответы с ошибками:

```json
{
  "success": false,
  "error": "Сообщение об ошибке"
}
```

---

## Справочник по полям ответа

Полный справочник по всем полям данных, возвращаемых API.

### Поля данных производительности

| Поле | Тип | Описание | Пример |
|------|-----|----------|--------|
| `date` | string | Дата в формате `YYYY-MM-DD` | `"2025-11-25"` |
| `hour` | string | Час дня (0-23), только для почасовых данных | `"10"`, `"23"` |
| `asset_gid` | string | Уникальный идентификатор ассета | `"AP1008794"` |
| `country_code` | string | Код страны ISO 3166-1 alpha-2 | `"US"`, `"GB"`, `"CA"` |
| `country_name` | string | Полное название страны | `"United States"` |
| `channel` | string | Канал трафика | `"search"`, `"display"` |
| `device` | string | Тип устройства | `"Desktop"`, `"Mobile"`, `"Tablet"` |
| `revenue` | float | Доход в USD | `125.50` |
| `ad_clicks` | integer | Количество кликов | `1250` |
| `ctr` | float | CTR (в процентах) | `2.5` |
| `rpc` | float | Доход на клик в USD | `0.10` |

### Поля метаданных

| Поле | Тип | Описание |
|------|-----|----------|
| `success` | boolean | Успешен ли запрос |
| `meta.count` | integer | Количество возвращённых записей |
| `meta.filters` | object | Применённые фильтры |
| `meta.storage.new_records` | integer | Количество новых сохранённых записей |
| `meta.storage.updated_records` | integer | Количество обновлённых записей |

### Детали полей

#### Метрики дохода

- **revenue**: Общий доход в USD с точностью до 2 знаков (центы)
- **rpc**: Доход на клик = Доход / Клики
- **ctr**: Показатель кликабельности = (Клики / Показы) × 100

#### Измерения

Данные агрегируются по следующим измерениям:
- **Дневные данные**: Дата, Ассет, Страна, Канал, Устройство
- **Почасовые данные**: Дата, Час, Ассет, Страна, Канал, Устройство

---

## Ограничение запросов

- **Лимит:** 60 запросов в минуту на API ключ
- **Заголовки:** `X-RateLimit-Limit`, `X-RateLimit-Remaining`

При превышении лимита:

```json
{
  "message": "Too Many Attempts."
}
```

---

## Ответы с ошибками

### Ошибки аутентификации

#### 401 - Отсутствует API ключ
```json
{
  "success": false,
  "error": "API key is required. Please provide API-Key header."
}
```

#### 401 - Неверный API ключ
```json
{
  "success": false,
  "error": "Invalid API key."
}
```

### Ошибки сервера

#### 500 - Ошибка валидации
```json
{
  "success": false,
  "error": "Validation error: {details}"
}
```

#### 500 - Сервис недоступен
```json
{
  "success": false,
  "error": "Perion API error: 503 - Service temporarily unavailable"
}
```

---

## Рекомендации

### Диапазоны дат
- **Дневные данные**: Можно запрашивать любой исторический период
- **Почасовые данные**: Только за последние 14 дней
- Всегда используйте формат `YYYY-MM-DD`

### Фильтрация
- Используйте `asset_gid` для фильтрации конкретных ассетов
- Несколько ассетов: разделяйте запятыми (без пробелов)
  - Пример: `asset_gid=AP1008794,AP1008795,AP1008796`

### Производительность
- Запрашивайте только необходимые диапазоны дат
- Используйте фильтры для уменьшения размера ответа
- Реализуйте экспоненциальную задержку при неудачных запросах
- Кэшируйте успешные ответы при необходимости

### Актуальность данных
- Дневные данные: обычно доступны после полуночи UTC
- Почасовые данные: доступны с задержкой ~2 часа

---

## Следующие шаги

- [Руководство по аутентификации](/ru/guide/authentication) - Настройка API ключа
- [Примеры кода](/ru/examples/php) - Примеры реализации
